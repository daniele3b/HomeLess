<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-resource@1.5.1"></script>

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css"
    />
    <title>Question Management</title>
  </head>
  <body>
    <div class="container-fluid">
      <div class="container">
        <div id="app">
          <div class="card">
            <div class="card-title mt-2">
              <center>
                <h4><b>Question Management</b></h4>
              </center>
            </div>

            <!-- VIEW MODE-->

            <div class="card-body" v-if="viewMode">
              <div class="table-responsive" style="height: 550px">
                <table class="table">
                  <thead class="thead-light">
                    <tr>
                      <th scope="col">ID</th>
                      <th scope="col">TEXT</th>
                      <th scope="col">NEXT QUESTIONS</th>
                      <th scope="col">Edit</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="question in questions">
                      <td>{{question.question_id}}</td>
                      <td>{{question.text}}</td>
                      <td style="max-width: 250px">
                        {{question.template_id}}
                        <p v-for="next in question.nextQuestions">
                          {{next.answer}} -> {{next.nextQuestionId}}
                        </p>
                      </td>
                      <td>
                        <p
                          data-placement="top"
                          data-toggle="tooltip"
                          title="Edit"
                        >
                          <button
                            :id="question.question_id"
                            class="btn btn-primary btn-xs"
                            data-title="Edit"
                            @click="switch2Edit"
                            data-toggle="modal"
                            data-target="#edit"
                          >
                            <span class="glyphicon glyphicon-trash"></span>
                          </button>
                        </p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <center>
                <button
                  type="button"
                  data-title="Add"
                  class="btn btn-success mt-1"
                >
                  Add a new question
                </button>
                <button
                  type="button"
                  data-title="Remove"
                  class="btn btn-danger mt-1"
                  @click="switch2Remove()"
                >
                  Remove Questions
                </button>
              </center>
            </div>

            <!-- EDIT MODE-->

            <div class="card-body" v-else-if="editMode">
              <h5 @click="fromEdit2View()" style="color: blue; cursor: pointer">
                <-Back
              </h5>
              <center>
                <div>
                  TEXT
                  <input type="text" v-model="text" />

                  <div class="mt-1" v-if="answers.length!=0">
                    <b> Next Questions</b>
                  </div>
                  <div class="mt-2" v-for="answer in answers">
                    {{answer.nextQuestionId}}
                    <input type="text" v-model="answer.answer" />
                  </div>
                  <div class="mt-2" v-if="template_id!=null">
                    TEMPLATE ID
                    <input type="text" v-model="template_id" />
                  </div>

                  <button
                    @click="confirmEdit()"
                    type="button"
                    data-title="Edit question"
                    class="btn btn-success mt-2"
                  >
                    Edit question
                  </button>
                </div>
              </center>
            </div>

            <!-- REMOVE MODE-->

            <div class="card-body" v-else-if="removeMode">
              <div class="table-responsive" style="height: 550px">
                <table class="table">
                  <thead class="thead-light">
                    <tr>
                      <th scope="col">ID</th>
                      <th scope="col">TEXT</th>
                      <th scope="col">NEXT QUESTIONS</th>
                      <th scope="col">Delete</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="question in removableQuestions">
                      <td>{{question.question_id}}</td>
                      <td>{{question.text}}</td>
                      <td style="max-width: 250px">
                        {{question.template_id}}
                        <p v-for="next in question.nextQuestions">
                          {{next.answer}} -> {{next.nextQuestionId}}
                        </p>
                      </td>
                      <td>
                        <p
                          data-placement="top"
                          data-toggle="tooltip"
                          title="Edit"
                        >
                          <button
                            :id="question.question_id"
                            class="btn btn-danger btn-xs"
                            data-title="Delete"
                            @click="removeQuestion()"
                            data-toggle="modal"
                            data-target="#edit"
                          >
                            <span class="glyphicon glyphicon-trash"></span>
                          </button>
                        </p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      var app = new Vue({
        el: "#app",
        data: {
          questions: [],
          currentQuestion: null,
          viewMode: true,
          editMode: false,
          removeMode: false,
          removableQuestions: [],
          text: "",
          answers: [],
          template_id: null,
        },

        beforeCreate: function () {
          this.$http.get("http://localhost:8080/getQuestionsENG/2").then(
            (response) => {
              this.questions = response.body;
            },
            (response) => {
              // error callback
            }
          );
        },

        methods: {
          switch2Edit: function (event) {
            this.viewMode = false;
            this.editMode = true;

            let question_id = event.target.id;

            let i = 0;
            for (i = 0; i < this.questions.length; i++) {
              if (this.questions[i].question_id == question_id) {
                this.currentQuestion = this.questions[i];
                break;
              }
            }

            this.text = this.currentQuestion.text;
            this.answers = this.currentQuestion.nextQuestions;
            this.template_id = this.currentQuestion.template_id;
          },
          fromEdit2View: function () {
            this.editMode = false;
            this.viewMode = true;
            this.text = "";
            this.answers = [];
            this.template_id = null;

            this.$http.get("http://localhost:8080/getQuestionsENG/2").then(
              (response) => {
                this.questions = response.body;
              },
              (response) => {
                // error callback
              }
            );
          },
          switch2Remove: function () {
            this.removeMode = true;
            this.viewMode = false;

            this.$http.get("/getRemovableQuestions/2/ENG").then(
              (response) => {
                this.removableQuestions = response.body;
              },
              (response) => {
                // error callback
              }
            );
          },
          confirmEdit: function () {
            this.$http
              .put(
                "http://localhost:8080/modifyQuestion/" +
                  this.currentQuestion.question_id +
                  "/2/ENG",
                {
                  text: this.text,
                  nextQuestions: this.answers,
                  template_id: this.template_id,
                }
              )
              .then(
                (response) => {
                  this.$http
                    .get("http://localhost:8080/getQuestionsENG/2")
                    .then(
                      (response) => {
                        this.questions = response.body;
                      },
                      (response) => {
                        // error callback
                      }
                    );
                  this.text = "";
                  this.answers = [];
                  this.template_id = null;

                  this.editMode = false;
                  this.viewMode = true;
                },
                (response) => {
                  // error callback
                }
              );
          },
        },
      });
    </script>

    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
      integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
      crossorigin="anonymous"
    ></script>
  </body>
</html>

<style>
  .inserimento {
    width: 220px;
    height: 30px;
  }

  input[type="submit"] {
    background-color: #4caf50;
    cursor: pointer;
    /*border-radius: 20px;*/
  }

  #card-form {
    background-color: #fdc513;
    width: 400px;
    height: 750px;
    -webkit-box-shadow: 10px 10px 5px -5px rgba(250, 205, 5, 0.75);
    -moz-box-shadow: 10px 10px 5px -5px rgba(250, 205, 5, 0.75);
    box-shadow: 10px 10px 5px -5px rgba(250, 205, 5, 0.75);
  }

  .card {
    background-color: #fdc513;
    -webkit-box-shadow: 10px 10px 5px -5px rgba(250, 205, 5, 0.75);
    -moz-box-shadow: 10px 10px 5px -5px rgba(250, 205, 5, 0.75);
    box-shadow: 10px 10px 5px -5px rgba(250, 205, 5, 0.75);
  }

  body {
    background-color: #fff7e0;
  }

  .card-text {
    position: relative;
  }
</style>
